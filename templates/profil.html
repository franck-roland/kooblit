{% extends "base.html" %}
{% load staticfiles %}

{% block extra_css %}
<link href="{% static "css/cart.css" %}" rel="stylesheet">
<link href="{% static "css/profile.css" %}" rel="stylesheet">
{% endblock %}

{% block content %}

{% if messages %}
    <div class="container">
      {% for message in messages %}
        <div class="alert alert-dismissable {% if message.tags %} alert-{{ message.tags }} {% endif %}">
          <button type="button" class="close" data-dismiss="alert">×</button>
          {{ message|safe }}
        </div>
      {% endfor %}
    </div>
{% endif %}


<div class="container">
  <div class="row">
    <div class="header">
      <h2><i class="fa fa-home"></i> Mon Espace</h2>
    </div>
  </div>

  <div class="row labels">
    <div class="col-sm-4 col-xs-12"><h3>Mes synthèses</h3></div>

    {% if syntheses_ecrites %}
      <div class="col-sm-2 col-xs-3"><h4>Prix de vente (TTC)</h4></div>
      <div class="col-sm-2 col-xs-3"><h4>Note moyenne</h4></div>
      <div class="col-sm-2 col-xs-3"><h4>Nombre de ventes</h4></div>
      <div class="col-sm-2 col-xs-3"><h4>Gain (TTC)</h4></div>
    {% endif %}
  </div>

  {% if syntheses_ecrites %}
    {% for synth  in syntheses_ecrites %}
      <div class="row">
        <div class="col-sm-4 col-xs-12">
          {% include "kooblit_card.html" with title=synth.book_title author=synth.author %}
        </div>

        <p class="col-sm-2 col-xs-3 price">{{synth.prix|title}}€</p>
        <p class="col-sm-2 col-xs-3 price">{{synth.note_moy|title}}</p>
        <p class="col-sm-2 col-xs-3 price">{{synth.nb_achat|title}}</p>
        <p class="col-sm-2 col-xs-3 price">{{synth.gain|title}}€</p>
      </div>
    {% endfor %}

    <div class="row total">
      <div class="col-sm-10 col-xs-6">
        <h2>Total</h2>
      </div>
      <p class="col-sm-2 col-xs-1 price">{{total}}€</p>
      <p class="col-sm-3 col-sm-offset-7 col-xs-10 col-xs-offset-1 cagnotte_info">
        Votre cagnotte doit être supérieure à 15€ pour pouvoir être virée sur votre compte
      </p>
      <div class="col-sm-2 col-sm-offset-0 col-xs-6 col-xs-offset-3 valider_achat">
        <a href="{% url 'achats:paiement' %}" class="abtn"> Vider la cagnotte </a>
      </div>
    </div>

  {% else %}
    <div class="col-xs-12">
      <h1 class="no_synthese">Vous n'avez pas écrit de synthèse pour le moment</h1>
    </div>
  {% endif %}

  <div class="row achats">
    <div class="col-xs-12">
      <h3> Mes achats </h3>
    </div>

    {% if syntheses_achetees %}
      <div class="col-xs-12 col-xs-offset-0 col-sm-10 col-sm-offset-1">

        {% for synth in syntheses_achetees %}
          {% include "kooblit_card.html" with title=synth.book_title author=synth.author synth_id=synth.id %}
        {% endfor %}

      </div>
    {% else %}
      <div class="col-xs-12">
        <h1 class="no_synthese">Vous n'avez rien acheté</h1>
      </div>
    {% endif %}

  </div>
</div>
{% endblock %}
{% block script_block %}
<script src="{% static "js/colorize.js" %}" type="text/javascript"></script>
<script type="text/javascript">
  $(window).load(function(){
      $(".image_extract").each(function(index, element){
        colorize(index, element);
      })
  });
</script>
{% endblock %}