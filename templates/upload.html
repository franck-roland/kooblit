{% extends "base.html" %}
{% load staticfiles %}
{% block extra_css %}
<link href="{% static "css/upload.css" %}" rel="stylesheet">
{% endblock %}
{% block content %}

{% if prev %}
<div class="container" style="padding-top:50px;">
    <div class="progress">
      <div class="progress-bar" style="width: 100%;"></div>
    </div>
</div>
<div id="prev" class="container">
    <h2>
        Les lignes ci-dessous résumeront votre synthèse:
    </h2>
</div>
<div class="container">
    <h2>
        Votre synthèse formatée en HTML:
    </h2>
    <div id="preview" class="container">
        {{ prev|safe }}
    </div>
</div>
<div class="container">
    <h2>
        Continuer?
    </h2>
    <div class="container" style="padding-top:30px;">
        <form method="POST">{% csrf_token %}
            <fieldset>
                <div class="form-group">
                    <div class="col-lg-10 col-lg-offset-2">
                        <button type="submit" class="btn btn-primary" name="non" value="non">Non</button>
                        <button type="submit" class="btn btn-primary" name="oui" value="oui">Oui</button>
                    </div>
                </div>
            </fieldset>
        </form>
    </div>
</div>
{% elif replace %}
<div class="container" style="padding-top:50px;">
    <div class="progress">
      <div class="progress-bar" style="width: 50%;"></div>
    </div>
</div>
<div class="container" style="padding-top:50px;padding-bottom:20px;background-color: rgba(0, 0, 0, 0.05)">
    <div>
        Une synthese pour ce livre existe déjà.
        Voulez vous la remplacer?
    </div>
    <div class="container" style="padding-top:30px;">
        <form method="POST">{% csrf_token %}
            <fieldset>
                <div class="form-group">
                    <div class="col-lg-10 col-lg-offset-2">
                        <input name="title" value="{{ title }}" type="hidden">
                        <button type="submit" class="btn btn-primary" name="non_replace" value="non">Non</button>
                        <button type="submit" class="btn btn-primary" name="oui_replace" value="oui">Oui</button>
                    </div>
                </div>
            </fieldset>
        </form>
    </div>
</div>

{% else %}
<div class="container" style="padding-top:50px;">
    <div class="progress">
      <div class="progress-bar" style="width: 0%;"></div>
    </div>
</div>
<div class="container" style="padding-top:50px;background-color: rgba(0, 0, 0, 0.05)">
 <form name='upload_form' class="form-horizontal django_form" method="post" enctype="multipart/form-data">{% csrf_token %}
    <div class="container">
        <div class="col-sm-6 col-md-6 col-lg-6">
        Pour que votre synthèse puisse être acceptée par notre système,
        elle doit avoir été intégrée dans le modèle proposé. Veuillez
        télécharger ce dernier via le bouton ci-contre et copier/coller votre
        texte en respectant le schéma du document (titre à la place du
        titre, 1ère partie à la place de 1ère partie etc...). Le texte présent
        sur le document à l'origine doit totalement disparaitre au profit du
        votre.
        </div>
        <div class="col-sm-6 col-md-6 col-lg-6">
        <a href="{% static "docx/template.docx"%}"> <button type="button" class="btn btn-primary">Télécharger le template</button> </a>
        </div>
    </div>
    <div class="error">
        {{ error }}
    </div>
    <div class="container">
        <div class="form-group">
            <label for="id_file" class="control-label ">Synthèse</label>
                <input id="id_file" type="file" name="file" required></input>
                {{ form.file.errors }}
        </div>
        <div class="form-group">
            <div class="col-lg-4 col-lg-offset-4">
                <button type="submit" class="btn btn-primary">Envoyer</button>
            </div>
        </div>
    </div>
</form>
</div>
{% endif %}
<!-- <form action="">
    {% csrf_token %}
     <div class="tabbable">
        <ul class="nav nav-tabs">
          <li class="active"><a href="#tab1" data-toggle="tab">Section 1</a></li>
          <li class=""><a href="#tab2" data-toggle="tab">Section 2</a></li>
        </ul>
        <div class="tab-content">
          <div class="tab-pane active" id="tab1">
            <div class="error">
                {{ error }}
            </div>
            <div class="form-group">
                <label for="id_title" class="col-lg-4 control-label ">Titre de la synthese</label>
                <div class="col-lg-8 input-container" >
                    {{ form.title }}
                    {{ form.title.errors }}
                </div>
            </div>
            <div class="form-group">
                <label for="id_file" class="col-lg-4 control-label ">Fichier</label>
                <div class="col-lg-8 input-container" >
                    {{ form.file }}
                    {{ form.file.errors }}
                </div>
            </div>
            <div class="form-group">
                <div class="col-lg-4 col-lg-offset-4">
                    <button type="submit" class="btn btn-primary">Envoyer</button>
                </div>
            </div>
            <a href="#tab2" data-toggle="tab" class="btn pull-right">Next</a>
          </div>
          <div class="tab-pane" id="tab2">
            {% if prev %}
                <div id="prev" class="container">
                <h2>
                    Les lignes ci-dessous résumeront votre synthèse:
                </h2>
                </div>
                <div class="container">
                <h2>
                    Votre synthèse formatée en HTML:
                </h2>
                    <div id="preview" class="container">
                        {{ prev|safe }}
                    </div>
                </div>
            {% endif %}
            <a href="#tab1" data-toggle="tab" class="btn pull-left">Prev</a>
          </div>
        </div>
      </div>
</form> -->

<!-- <form id='ss' method="post" >
    {% csrf_token %}
    <textarea id="elt1" name="content" id="my_editor"></textarea>
    <div class="form-group">
        <div class="col-lg-4 col-lg-offset-4">
            <button type="submit" class="btn btn-primary">Envoyer</button>
        </div>
    </div>
</form> -->

{% endblock %}
{% block script_block %}
<script src="//tinymce.cachefly.net/4.1/tinymce.min.js"></script>
<script>
$( "#prev" ).append('<div class="container resume" > '+$('.summary').html()+'</div>');
var temp=''
    tinymce.init({
        selector:'textarea',

    });
    $(document).on('submit','#ss',function (e) {
    e.preventDefault();
    var ed = tinyMCE.get('elt1');
    var data = ed.getContent();
    $.ajax({
        type:       'POST',
        cache:      false,
        url:        '#',
        data:       {'data' :(data),
                    'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val()},
        success:    function(){
                    // $("#ss").remove();
                    // $("#output").html(data);
                    }
    });
    return false;
});
</script>
{% endblock %}